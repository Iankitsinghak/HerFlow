{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the user's authentication ID. (Relationship: User 1:1 UserProfile)"
        },
        "username": {
          "type": "string",
          "description": "The user's chosen username."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "profilePicture": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "bio": {
          "type": "string",
          "description": "A short biography or description of the user."
        }
      },
      "required": [
        "id",
        "userId",
        "username",
        "email"
      ]
    },
    "CycleLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CycleLog",
      "type": "object",
      "description": "Represents a user's menstrual cycle log entry.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the cycle log entry."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the user who created the log. (Relationship: User 1:N CycleLog)"
        },
        "startDate": {
          "type": "string",
          "description": "The start date of the menstrual cycle.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "The end date of the menstrual cycle.",
          "format": "date-time"
        },
        "symptoms": {
          "type": "array",
          "description": "An array of symptoms experienced during the cycle.",
          "items": {
            "type": "string"
          }
        },
        "notes": {
          "type": "string",
          "description": "Additional notes about the cycle."
        }
      },
      "required": [
        "id",
        "userId",
        "startDate"
      ]
    },
    "BlogPost": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "BlogPost",
      "type": "object",
      "description": "Represents a blog post related to women's health.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the blog post."
        },
        "authorId": {
          "type": "string",
          "description": "Reference to the user who authored the post. (Relationship: User 1:N BlogPost)"
        },
        "title": {
          "type": "string",
          "description": "The title of the blog post."
        },
        "content": {
          "type": "string",
          "description": "The main content of the blog post."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the blog post's image.",
          "format": "uri"
        },
        "tags": {
          "type": "array",
          "description": "An array of tags associated with the blog post.",
          "items": {
            "type": "string"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the blog post was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "authorId",
        "title",
        "content",
        "createdAt"
      ]
    },
    "CommunityPost": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CommunityPost",
      "type": "object",
      "description": "Represents a community forum post.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the community post."
        },
        "authorId": {
          "type": "string",
          "description": "Reference to the user who created the post. (Relationship: User 1:N CommunityPost)"
        },
        "title": {
          "type": "string",
          "description": "The title of the community post."
        },
        "content": {
          "type": "string",
          "description": "The content of the community post."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the community post was created.",
          "format": "date-time"
        },
        "likes": {
          "type": "number",
          "description": "Number of likes this post has. "
        },
        "tags": {
          "type": "array",
          "description": "References to Tags. (Relationship: Tag N:N CommunityPost)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "authorId",
        "title",
        "content",
        "createdAt"
      ]
    },
    "DoctorQuestion": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DoctorQuestion",
      "type": "object",
      "description": "Represents a question asked to a doctor.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the doctor question."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the user who asked the question. (Relationship: User 1:N DoctorQuestion)"
        },
        "question": {
          "type": "string",
          "description": "The question asked to the doctor."
        },
        "answer": {
          "type": "string",
          "description": "The answer provided by the doctor."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the question was asked.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "question",
        "createdAt"
      ]
    },
    "Tag": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Tag",
      "type": "object",
      "description": "Represents a tag for categorizing community posts and blog posts.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the tag."
        },
        "name": {
          "type": "string",
          "description": "The name of the tag."
        }
      },
      "required": [
        "id",
        "name"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/userProfiles/{profileId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. The `userId` parameter ensures path-based ownership, allowing users to only access their own profile data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "profileId",
              "description": "The unique ID of the user profile document.  It's recommended this is the same as the userId."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/cycleLogs/{cycleLogId}",
        "definition": {
          "entityName": "CycleLog",
          "schema": {
            "$ref": "#/backend/entities/CycleLog"
          },
          "description": "Stores menstrual cycle log entries for each user. The `userId` parameter ensures path-based ownership, allowing users to only access their own cycle logs.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "cycleLogId",
              "description": "The unique ID of the cycle log entry."
            }
          ]
        }
      },
      {
        "path": "/blogPosts/{blogPostId}",
        "definition": {
          "entityName": "BlogPost",
          "schema": {
            "$ref": "#/backend/entities/BlogPost"
          },
          "description": "Stores blog posts related to women's health.  The `authorId` field inside the blogPost document is used for authorization to simplify rules.  The rule `request.auth.uid == resource.data.authorId` gives create/update/delete access to the author.",
          "params": [
            {
              "name": "blogPostId",
              "description": "The unique ID of the blog post."
            }
          ]
        }
      },
      {
        "path": "/communityPosts/{communityPostId}",
        "definition": {
          "entityName": "CommunityPost",
          "schema": {
            "$ref": "#/backend/entities/CommunityPost"
          },
          "description": "Stores community forum posts. The `authorId` field inside the communityPost document is used for authorization. The rule `request.auth.uid == resource.data.authorId` gives create/update/delete access to the author.",
          "params": [
            {
              "name": "communityPostId",
              "description": "The unique ID of the community post."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/doctorQuestions/{questionId}",
        "definition": {
          "entityName": "DoctorQuestion",
          "schema": {
            "$ref": "#/backend/entities/DoctorQuestion"
          },
          "description": "Stores questions asked to doctors by users. The `userId` parameter ensures path-based ownership, allowing users to only access their own questions.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "questionId",
              "description": "The unique ID of the doctor question."
            }
          ]
        }
      },
      {
        "path": "/tags/{tagId}",
        "definition": {
          "entityName": "Tag",
          "schema": {
            "$ref": "#/backend/entities/Tag"
          },
          "description": "Stores tags for categorizing community posts and blog posts.  Tags are globally accessible.",
          "params": [
            {
              "name": "tagId",
              "description": "The unique ID of the tag."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and ease of debugging, adhering to the core design principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters). It leverages denormalization for authorization, structural segregation based on access needs, and consistent access modeling. \n\nAuthorization Independence is achieved by denormalizing authorization-related data. For example, the `CycleLog`, `BlogPost`, `CommunityPost`, and `DoctorQuestion` collections each contain the `userId` or `authorId` field, eliminating the need to perform `get()` operations to verify ownership. This ensures that security rules can be atomic and efficient, and it simplifies transactions and batch operations. Global roles aren't part of the data model given the instructions, but they could easily be added using Existence over Content strategy.\n\nStructural Segregation is applied by using path-based ownership for user-specific data (e.g., `/users/{userId}/cycleLogs/{cycleLogId}`). This allows for simple security rules that grant users full access to data under their respective paths. Public content, if any, would reside in separate collections without user-specific paths.\n\nAccess Modeling is standardized around path-based ownership for private user data, such as cycle logs and doctor questions. Collaborative data is not explicitly modeled in this design based on the app requirements, but if present, would use a membership map (`members: {uid1: \"role\", uid2: \"role\"}`) for authorization. Global roles are not present.\n\nThis structure facilitates secure `list` operations (QAPs) because collections are segregated based on access control requirements. Rules can allow listing of items in `/users/{userId}/cycleLogs` only if the requesting user's `uid` matches the `userId` parameter, preventing unauthorized listing of cycle logs. Similarly, listing of community posts would be allowed based on separate criteria, as those posts are not owned by a single user.\n\nThe explicit modeling of data with dedicated `status` fields (if applicable in the future) and predictable schemas contributes to data clarity and debuggability. Standardized naming conventions (e.g., `userId` for user references, `{cycleLogId}` for cycle log IDs) enhance consistency across the database."
  }
}